/* Sidebar / Navigation module (extracted from styles.css)
   Depends on theme tokens defined in :root (styles.css)
*/

/* Chart Navigation Sidebar */
.chart-navigation {
  width: var(--sidebar-w);
  min-width: var(--sidebar-w); /* ensure it never shrinks when scrollbar appears */
  /* Leave room for fixed top bar and bottom ribbon; adapt if those heights change */
  height: calc(
    100vh - var(--topbar-h, 56px) - var(--edu-ribbon-h, 24px) - env(safe-area-inset-bottom, 0px)
  );
  /* Theme-aware gradient using CSS variables; allow override via --sidebar-surface */
  background: var(
    --sidebar-surface,
    linear-gradient(90deg, var(--header-gradient-left) 0%, var(--header-gradient-right) 100%)
  );
  border-right: 1px solid var(--sidebar-border, rgba(0, 0, 0, 0.12));
  position: fixed;
  left: 0;
  top: var(--topbar-h);
  overflow-y: scroll; /* always show vertical scrollbar to avoid layout shift */
  overflow-x: hidden; /* prevent underlines from extending beyond sidebar */
  z-index: var(--z-sidebar);
  box-shadow: var(--elev-none);
  /* No transition on desktop to avoid perceived lag; mobile sets its own in mobile-patch-v2.css */
  transition: none;
  contain: layout style; /* Performance optimization - isolate layout calculations */
  will-change: auto; /* Avoid unnecessary layer promotion on desktop */
  color: var(--sidebar-fg, inherit);
}

/* Dark theme overrides use neutral surface rather than gradient for legibility */
html[data-theme='dark'] .chart-navigation {
  background: var(--sidebar-surface-dark, linear-gradient(90deg, #1f2937 0%, #111827 100%));
  border-right-color: var(--sidebar-border-dark, rgba(255, 255, 255, 0.12));
  color: var(--sidebar-fg-dark, rgba(255, 255, 255, 0.92));
}

/* Progressive enhancement: reserve space for vertical scrollbar where supported */
@supports (scrollbar-gutter: stable) {
  .chart-navigation {
    /* Reserve space only on the scrollbar side (right in LTR) to avoid a left gutter */
    scrollbar-gutter: stable;
  }
}

/* Prefer dynamic viewport units on supporting browsers to avoid URL bar jank */
@supports (height: 100dvh) {
  .chart-navigation {
    height: calc(
      100dvh - var(--topbar-h, 56px) - var(--edu-ribbon-h, 24px) - env(safe-area-inset-bottom, 0px)
    );
  }
}
.chart-navigation.collapsed {
  transform: translateX(calc(-1 * var(--sidebar-w)));
}
/* Dark mode is represented by the absence of data-theme="light" on <html> */
html[data-theme='dark'] .chart-navigation {
  /* Use deep elevation token for dark mode emphasis */
  box-shadow: var(--elev-deep);
}

/* Ensure full height for chart navigation */
body:has(.chart-navigation) {
  margin: 0;
}
.chart-navigation * {
  box-sizing: border-box;
}
/* Reset list styles to avoid bullets/radios in nav */
.chart-navigation ul,
.chart-navigation li,
.sidebar-nav-panel ul,
.sidebar-nav-panel li {
  list-style: none;
  margin: 0;
  padding: 0;
}
/* General sidebar text on UND Gray chrome */
html[data-theme='dark'] .chart-navigation {
  color: rgba(255, 255, 255, 0.92);
}
html:not([data-theme='dark']) .chart-navigation {
  color: var(--text);
}
/* Nav items and their children use near-white only in dark theme */
/* Dark theme base: let later hover/active overrides apply (avoid over-specific * selector) */
html[data-theme='dark'] .chart-navigation .section-nav-item {
  color: rgba(255, 255, 255, 0.88);
}
/* Ensure Case File badge not inheriting sidebar gradient text color overrides */
.case-file-header,
.case-file-header .case-file-badge {
  color: var(--white);
}
/* Keep case header card using default text color (it has a light background) */
.chart-navigation .case-header,
.chart-navigation .case-header * {
  color: var(--text);
}
/* Optional: titles inside the gray zone can be pure white */
.chart-navigation .nav-section-title,
.chart-navigation .sidebar-title {
  color: var(--white);
}

/* Note Progress header geometry */
.chart-navigation .current-encounter-header {
  margin: 0 0 12px 0;
  padding: 8px 12px;
  font-size: var(--font-md, 0.875rem); /* 14px */
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-radius: var(--radius-sm, 4px);
  display: flex;
  align-items: center;
  justify-content: flex-start; /* left align the label */
  position: relative; /* enable ::after indicator */
  cursor: pointer; /* toggleable */
}
/* Theme-aware colors: subtle UND gray background, UND green text/border */
/* Base background and text */
html[data-theme='dark'] .chart-navigation .current-encounter-header {
  background: transparent; /* remove translucent background from My Note */
  color: var(--white);
}
html:not([data-theme='dark']) .chart-navigation .current-encounter-header {
  background: transparent; /* remove translucent background from My Note */
  color: var(--white);
}
/* Dynamic underline color based on overall note status */
.chart-navigation .current-encounter-header {
  --note-underline: var(--und-green);
  border-bottom: 2px solid var(--note-underline);
}
.chart-navigation .current-encounter-header[data-status='empty'] {
  --note-underline: var(--surface-light-border);
}
.chart-navigation .current-encounter-header[data-status='partial'] {
  --note-underline: var(--und-orange);
}
.chart-navigation .current-encounter-header[data-status='complete'] {
  --note-underline: var(--und-green);
}
/* Right-side disclosure indicator (rotates) */
.chart-navigation .current-encounter-header::after {
  content: '';
  position: absolute;
  right: 12px;
  top: 50%;
  width: 0;
  height: 0;
  border-style: solid;
  border-width: 7px 0 7px 10px; /* right-pointing triangle */
  border-color: transparent transparent transparent rgba(255, 255, 255, 0.9);
  transform: translateY(-50%) rotate(0deg);
  transform-origin: 50% 45%;
  opacity: 0.95;
  transition: transform 160ms ease;
}
.chart-navigation .current-encounter-header[aria-expanded='true']::after {
  transform: translateY(-50%) rotate(90deg); /* down */
}
.chart-navigation .current-encounter-header:focus-visible {
  outline: 3px solid var(--und-orange);
  outline-offset: 2px;
}
@media (prefers-reduced-motion: reduce) {
  .chart-navigation .current-encounter-header::after {
    transition: none;
  }
}

/* Collapsible container for the sections list under "My Note" */
.chart-navigation .note-sections {
  overflow: hidden;
  will-change: max-height, opacity, transform;
  transition:
    max-height 240ms ease,
    opacity 160ms ease,
    transform 160ms ease;
}
.chart-navigation .note-sections.is-collapsed {
  pointer-events: none;
}

/* Artifact pills styling */
.chart-navigation .artifact-list {
  display: flex;
  flex-direction: column;
  gap: 0.25rem; /* tighter stack for table-like density */
}
/* Artifact entries mimic subsection items */
.chart-navigation .artifact-list .artifact-entry {
  padding: 6px 10px;
  background: var(--white);
  border: 1px solid var(--surface-light-border);
  border-radius: var(--radius-md, 8px);
  font-size: var(--font-sm, 0.8125rem);
  font-weight: 500;
  text-align: left;
  cursor: pointer;
  transition:
    background-color 0.18s ease,
    border-color 0.18s ease,
    box-shadow 0.18s ease;
}
html[data-theme='dark'] .chart-navigation .artifact-list .artifact-entry {
  background: var(--panel);
  border-color: var(--color-border);
  color: rgba(255, 255, 255, 0.9);
}
.chart-navigation .artifact-list .artifact-entry:hover {
  background: var(--surface-light-hover);
}
html[data-theme='dark'] .chart-navigation .artifact-list .artifact-entry:hover {
  background: var(--bg-hover);
}
.chart-navigation .artifact-list .artifact-entry:focus-visible {
  outline: 3px solid var(--und-orange);
  outline-offset: 2px;
}
.chart-navigation .artifact-list .artifact-entry svg {
  width: 18px;
  height: 18px;
  opacity: 0.85;
}
.chart-navigation .artifact-list .artifact-entry-title {
  flex: 1;
}

/* Grouped artifact categories (collapsible folders) */
.chart-navigation .grouped-artifacts {
  margin: 4px 0 8px 0;
}
.chart-navigation .artifact-category {
  margin: 0 0 6px 0;
}
.chart-navigation .artifact-cat-header {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 0.375rem;
  background: var(--surface-light);
  border: 1px solid var(--surface-light-border);
  border-radius: 6px;
  padding: 4px 8px 4px 6px;
  font-size: 0.8125rem; /* 13px */
  font-weight: 600;
  letter-spacing: 0.25px;
  text-align: left;
  cursor: pointer;
  line-height: 1.3;
  transition:
    background-color 0.18s ease,
    border-color 0.18s ease,
    box-shadow 0.18s ease;
}
/* Explicit light theme overrides (text was washing out on white) */
html:not([data-theme='dark']) .chart-navigation .artifact-cat-header {
  background: var(--white); /* crisp white chip */
  border-color: var(--surface-light-border);
  color: var(--text-on-light, var(--text));
  box-shadow:
    0 1px 2px rgba(0, 0, 0, 0.06),
    0 0 0 1px rgba(0, 0, 0, 0.04);
}
html:not([data-theme='dark']) .chart-navigation .artifact-cat-header:hover {
  background: var(--surface-light-hover, #f5f5f5);
  border-color: var(--surface-light-border);
  box-shadow:
    0 2px 4px rgba(0, 0, 0, 0.08),
    0 0 0 1px rgba(0, 0, 0, 0.05);
}
html:not([data-theme='dark']) .chart-navigation .artifact-cat-header .twisty {
  color: var(--text-secondary);
  /* Ensure indicator + label align vertically */
  display: flex;
  align-items: center;
}
html[data-theme='dark'] .chart-navigation .artifact-cat-header {
  background: var(--panel);
  border-color: var(--color-border);
  color: rgba(255, 255, 255, 0.9);
}
.chart-navigation .artifact-cat-header:hover {
  background: var(--surface-light-hover);
  border-color: var(--surface-light-border);
}
html[data-theme='dark'] .chart-navigation .artifact-cat-header:hover {
  background: var(--bg-hover);
  border-color: var(--color-border);
}
.chart-navigation .artifact-cat-header:focus-visible {
  outline: 3px solid var(--und-orange);
  outline-offset: 2px;
}
.chart-navigation .artifact-cat-header .twisty {
  font-size: 0.75rem;
  opacity: 0.85;
  transform: translateY(-1px); /* optical alignment */
}
.chart-navigation .artifact-category[data-empty='true'] .artifact-cat-header {
  opacity: 0.55;
}
html:not([data-theme='dark'])
  .chart-navigation
  .artifact-category[data-empty='true']
  .artifact-cat-header {
  opacity: 0.6;
}

/* Collapsible section cards */
.chart-navigation .sections-container {
  display: flex;
  flex-direction: column;
  gap: 0.375rem;
}
/* Section card container - dividers removed for cleaner look */
.chart-navigation .section-card {
  background: transparent;
  border: none;
  border-radius: 0;
  padding: 0;
  position: relative;
  margin-bottom: 0;
  /* status color variable (empty default) updated via modifier classes */
  --status-color: var(--surface-light-border);
}

/* Dividers between section cards removed */

/* Fallback colors for when status classes aren't applied */
.chart-navigation .section-card.active:not([class*='section-status-']) {
  --status-color: var(--und-green);
}
html[data-theme='dark'] .chart-navigation .section-card.active:not([class*='section-status-']) {
  --status-color: var(--und-green);
}

.chart-navigation .section-card.active {
  background: transparent;
  box-shadow: none;
}
html[data-theme='dark'] .chart-navigation .section-card {
  background: transparent;
  border: none;
}
/* Override legacy transparent backgrounds within the chart navigation panel */
.sidebar-nav-panel .chart-navigation .section-card > .section-nav-item {
  background: rgba(255, 255, 255, 0.36) !important;
  border: 1px solid rgba(255, 255, 255, 0.18) !important;
  border-radius: 4px !important;
}
html[data-theme='dark'] .sidebar-nav-panel .chart-navigation .section-card > .section-nav-item {
  background: rgba(255, 255, 255, 0.34) !important;
  border: 1px solid rgba(255, 255, 255, 0.18) !important;
}
html[data-theme='dark'] .chart-navigation .section-card.active {
  background: transparent;
  box-shadow: none;
}
/* Dark theme: keep the subtle translucent header background */
html[data-theme='dark'] .chart-navigation .section-card > .section-nav-item {
  background: rgba(255, 255, 255, 0.22);
}
/* Status modifiers set the --status-color token */
.chart-navigation .section-card.section-status-empty {
  --status-color: var(--surface-light-border);
}
.chart-navigation .section-card.section-status-partial {
  --status-color: var(--und-orange);
}
.chart-navigation .section-card.section-status-complete {
  --status-color: var(--und-green);
}
html[data-theme='dark'] .chart-navigation .section-card.section-status-empty {
  --status-color: var(--color-border);
}
html[data-theme='dark'] .chart-navigation .section-card.section-status-partial {
  --status-color: var(--und-orange);
}
html[data-theme='dark'] .chart-navigation .section-card.section-status-complete {
  --status-color: var(--und-green);
}

/* Slim vertical accent bar driven by status */
.chart-navigation .section-card::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 0.1875rem; /* 3px */
  background: var(--status-color);
  opacity: 0.55;
  transition:
    width 0.18s ease,
    opacity 0.18s ease;
  border-radius: 0.125rem; /* 2px */
}
.chart-navigation .section-card.active::before {
  width: 0.25rem; /* 4px */
  opacity: 1;
}

/* Restore comfortable spacing between the status bar and section headers */
.chart-navigation .section-card > .section-nav-item {
  padding: 0.375rem 12px 0.375rem 16px; /* even tighter height */
  display: flex;
  align-items: center;
  line-height: 1.25;
  box-sizing: border-box;
  background: rgba(255, 255, 255, 0.36); /* brighter, more obvious */
  border: 1px solid rgba(255, 255, 255, 0.18);
  border-radius: 4px;
}

/* Hover / active interactions disabled - cleaner look without background rectangles */

/* Active section items keep bold font weight for distinction */
html:not([data-theme='dark']) .chart-navigation .section-card.active > .section-nav-item {
  font-weight: 700 !important;
}

.chart-navigation .section-card:not(.active) > .section-nav-item {
  background: rgba(255, 255, 255, 0.36);
}

/* Status color indication via left border accent instead of underline */
.chart-navigation .section-card.active > .section-nav-item {
  border-left: 3px solid var(--status-color);
  font-weight: 700;
  /* keep visible background when active */
  background: rgba(255, 255, 255, 0.42);
  border: 1px solid rgba(255, 255, 255, 0.22);
}

/* (Replaced old border-color status styling with accent + underline color) */
/* Removed dirty-indicator styles (status now only via border color) */
.chart-navigation .section-card .subsection-toc {
  margin-top: 0.125rem; /* 2px: even tighter spacing */
  margin-left: 0.75rem; /* 12px */
  padding-left: 0.5rem; /* 8px */
  display: flex;
  flex-direction: column;
  gap: 0.25rem; /* 4px */
  position: relative;
  overflow: visible;
  max-height: 75rem; /* 1200px */
  opacity: 1;
  transition:
    max-height 0.25s ease,
    opacity 0.25s ease;
}
/* Removed vertical guide line inside section cards */
.chart-navigation .section-card .subsection-toc::before {
  content: none;
}

/* Subsection status indicators */
.subsection-indicator {
  display: inline-block;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  margin-right: 6px;
  flex-shrink: 0;
  /* Consistent 12x12 box that centers its content (checkmark) */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  vertical-align: middle;
  line-height: 1; /* avoid baseline shift for ✓ */
}
.subsection-indicator-empty {
  background: var(--surface-light-border);
}
html[data-theme='dark'] .subsection-indicator-empty {
  background: var(--bg);
  opacity: 0.5;
}
.subsection-indicator-partial {
  box-shadow: inset 0 0 0 1px var(--surface-light-border);
  background: linear-gradient(90deg, var(--und-orange) 50%, var(--color-border) 50%);
}
html[data-theme='dark'] .subsection-indicator-partial {
  box-shadow: inset 0 0 0 1px var(--color-border);
}
/* Complete indicator: green check mark styles applied to the glyph, keep geometry via base class */
.subsection-indicator-complete {
  color: var(--und-green);
  /* Match the 12x12 indicator box for perfect centering */
  font-size: 12px;
  font-weight: 700;
}
/* Subsection items: use secondary text unless active section, improve hierarchy */
.chart-navigation .section-card .subsection-item {
  color: var(--text-secondary);
}
/* Light theme: boost contrast of navigation text against darker gradient bg - OVERRIDE */
html:not([data-theme='dark']) .chart-navigation .section-card .section-nav-item {
  color: var(--white) !important;
}
html:not([data-theme='dark']) .chart-navigation .section-card .subsection-item {
  color: var(--white);
  opacity: 0.85; /* slight hierarchy */
}
html:not([data-theme='dark']) .chart-navigation .section-card.active .subsection-item {
  color: var(--white);
  opacity: 1;
}
.chart-navigation .section-card .subsection-item:hover {
  background: rgba(0, 0, 0, 0.06); /* subtle overlay */
  color: var(--text);
}
html[data-theme='dark'] .chart-navigation .section-card .subsection-item:hover {
  background: rgba(255, 255, 255, 0.08);
  color: var(--text);
}

.chart-navigation .section-card.active .subsection-item {
  color: var(--text);
}

.chart-navigation .section-card:not(.active) .subsection-item {
  color: var(--text-secondary);
}
/* Keyboard focus outlines */
.chart-navigation .section-card .section-nav-item:focus-visible,
.chart-navigation .section-card .subsection-item:focus-visible {
  outline: 0.125rem solid var(--status-color); /* 2px */
  outline-offset: 0.125rem; /* 2px */
}

/* Hover + active text color accent (UND green) - DISABLED TO PREVENT CONFLICTS */
/* Green accent on hover/active (place after base color rules) */
/*
html:not([data-theme='dark']) .chart-navigation .section-card .section-nav-item:hover,
html:not([data-theme='dark']) .chart-navigation .section-card.active > .section-nav-item,
html[data-theme='dark'] .chart-navigation .section-card .section-nav-item:hover,
html[data-theme='dark'] .chart-navigation .section-card.active > .section-nav-item {
  color: var(--und-green);
}
*/
html:not([data-theme='dark']) .chart-navigation .section-card .subsection-item:hover,
html:not([data-theme='dark']) .chart-navigation .section-card.active .subsection-item:hover,
html[data-theme='dark'] .chart-navigation .section-card .subsection-item:hover,
html[data-theme='dark'] .chart-navigation .section-card.active .subsection-item:hover {
  color: var(--und-green);
}
.chart-navigation .section-card.collapsed .subsection-toc {
  max-height: 0;
  opacity: 0;
  pointer-events: none;
}
.chart-navigation .artifact-category .artifact-list {
  margin-left: 2px;
}
/* Subtle divider when expanded */
/* Removed decorative divider between folder header and first artifact for tighter grouping */

/* Wrapper for artifacts area to control spacing above/below */
.chart-navigation .artifact-block {
  margin: 4px 0 6px 0; /* reduce space above first pill and below footer */
  overflow: hidden; /* allow height animation */
  will-change: max-height, opacity, transform;
  transition:
    max-height 240ms ease,
    opacity 160ms ease,
    transform 160ms ease;
}

.chart-navigation .artifact-block.is-collapsed {
  pointer-events: none;
}

.chart-navigation .artifact-pill {
  width: 100%;
  text-align: left;
  padding: 6px 10px; /* more condensed vertically */
  font-size: 1rem; /* 16px, larger text while staying compact */
  display: flex;
  align-items: center;
  gap: 0.5rem; /* keep spacing tight */
  justify-content: flex-start !important;
  min-height: 32px; /* override base .btn height for compact rows */
  line-height: 1.25;
}

.chart-navigation .artifact-pill svg {
  flex-shrink: 0;
  opacity: 0.8;
  width: 20px;
  height: 20px; /* scale icon up to match larger font */
}

/* Tighter footer area under list (Add Artifact button wrapper) */
.chart-navigation .artifact-add-footer {
  display: flex;
  justify-content: center;
  margin: 4px 0 4px 0; /* decrease space beneath add button */
}
.chart-navigation .artifact-add-footer .compact-add-btn {
  width: 34px;
  height: 34px;
  border-radius: 50%;
  background: var(--und-green);
  color: var(--white);
  font-weight: 700;
  font-size: 20px;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: var(--elev-fab);
  transition:
    transform 0.18s ease,
    box-shadow 0.18s ease,
    background-color 0.18s ease;
}
.chart-navigation .artifact-add-footer .compact-add-btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--elev-fab-hover);
  background: var(--und-green-dark, #006e2e);
}
.chart-navigation .artifact-add-footer .compact-add-btn:active {
  transform: translateY(0);
  box-shadow: var(--elev-fab);
}
.chart-navigation .artifact-add-footer .compact-add-btn:focus-visible {
  outline: 3px solid var(--und-orange);
  outline-offset: 2px;
}

/* White panel for navigation list inside gray sidebar */
.sidebar-nav-panel {
  /* Comfortable outer spacing so gradient shows around cards */
  margin: 8px 8px 12px 8px; /* symmetric margins to keep content centered */
  padding: 12px 12px 12px 12px; /* symmetric padding for visual balance */
  /* Safe bottom space so sticky footer actions don't collide with fixed page footer/ribbon */
  /* Modest safe space so content doesn't collide with bottom ribbon */
  padding-bottom: calc(var(--edu-ribbon-h) + env(safe-area-inset-bottom) + 16px);
  background: transparent; /* let gradient show through */
  border-radius: 0;
  box-shadow: none;
  overflow: visible;
  transition: none; /* eliminate subtle animation on panel */
}
/* Ensure base text color is dark in light theme within the white-panel area */
html:not([data-theme='dark']) .sidebar-nav-panel {
  color: var(--text-on-light);
}
/* Case Info pill (card) */
.case-info-card {
  background: var(--surface-light);
  border: 1px solid var(--surface-light-border);
  border-radius: 12px;
  padding: 12px;
  margin: 8px 0 12px 0;
  box-shadow: none;
  cursor: pointer;
  transition:
    background-color 0.2s ease,
    border-color 0.2s ease,
    transform 0.2s ease;
}
.case-info-card:hover {
  background-color: var(--surface-light-hover);
  border-color: var(--surface-light-border);
}
.case-info-card:focus-visible {
  outline: 3px solid var(--und-orange);
  outline-offset: 2px;
}

.case-info-card .case-title {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 8px;
}
.case-info-card .case-title-text {
  margin: 0;
  font-size: 1rem;
  font-weight: 700;
  color: var(--text);
}

.case-info-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 0.375rem;
}
.case-info-row {
  display: grid;
  grid-template-columns: 80px 1fr;
  align-items: center;
  gap: 0.5rem;
}
.case-info-row .label {
  color: var(--text-secondary);
  font-weight: 600;
  font-size: 0.75rem; /* 12px */
}
.case-info-row .value {
  color: var(--text);
  font-size: 0.75rem; /* 12px */
}

/* Ensure text uses dark-on-light inside white card */
.sidebar-nav-panel .case-info-card,
.sidebar-nav-panel .case-info-card * {
  color: var(--text);
}
/* Dark theme: case info card should be dark */
html[data-theme='dark'] .sidebar-nav-panel .case-info-card {
  background: var(--panel);
  border-color: var(--color-border);
}
html[data-theme='dark'] .sidebar-nav-panel .case-info-card:hover {
  background: var(--bg-hover);
  border-color: var(--color-border);
}
/* (Removed) Autosave status pill styles */
/* Flat list items in white panel */
/* Deprecated pill styles removed; list uses new underline pattern. Preserve spacing. */

/* Dark theme overrides with higher specificity */
html[data-theme='dark'] .sidebar-nav-panel .section-nav-item {
  color: var(--text);
}

html[data-theme='dark'] .sidebar-nav-panel .section-nav-item .nav-progress-text {
  color: var(--text-secondary);
  opacity: 0.95;
}

/* Chart navigation items - using proper cascade without !important */
.chart-navigation .section-nav-item {
  color: var(--text-on-light);
}

.chart-navigation .section-nav-item * {
  color: inherit;
}

.chart-navigation .section-nav-item .nav-progress-text {
  display: none;
}

/* Dark theme chart navigation */
html[data-theme='dark'] .chart-navigation .section-nav-item {
  color: var(--text);
}

html[data-theme='dark'] .chart-navigation .section-nav-item .nav-progress-text {
  color: var(--text-secondary);
}
/* Subsection list visuals inside the panel (rendered on dark gradient in both themes) */
/* Removed legacy border-left (was duplicating the vertical guide line created by
  .chart-navigation .section-card .subsection-toc::before). Keeping only the
  pseudo-element version for consistent spacing & theming. */
.sidebar-nav-panel .subsection-toc {
  border-left: none;
}
.sidebar-nav-panel .subsection-item {
  color: rgba(255, 255, 255, 0.92);
}
.sidebar-nav-panel .subsection-item:hover {
  color: var(--white);
  background-color: rgba(255, 255, 255, 0.08);
}

/* Case header (within sidebar) - border removed */
.case-header {
  padding: var(--space-5) var(--space-4);
  background: var(--bg-secondary);
  position: sticky;
  top: 0;
  z-index: var(--z-case-header);
  margin: 0;
}

/* Patient sticky header border (applied to #patient-sticky-header) */
/* Patient sticky header border handled in styles.css for unified geometry */

/* Sidebar "Case File" header (STABLE BADGE VERSION) */
.case-file-header {
  position: sticky;
  top: 0;
  z-index: 3001; /* ensure above other chrome (topbar is 3000) */
  height: var(--header-h, 56px);
  margin: 0;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent; /* badge supplies color */
  border: 0;
  /* Bring back the white underline across the full header width */
  border-bottom: var(--header-b, 2px) solid var(--white);
  position: sticky;
  /* Use a full-bleed background anchored to the header box to avoid any left gutter */
  isolation: isolate; /* create a new stacking context for ::before */
  transition: none; /* avoid any animation on sticky header */
  cursor: pointer; /* clickable for toggling artifacts */
  pointer-events: auto;
}
.case-file-header::before {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--und-green);
  z-index: -1; /* behind text */
  transition: none; /* ensure no bg animation */
}
.case-file-header:hover::before {
  filter: brightness(1.05);
}
.case-file-badge {
  all: unset; /* reset browser button styling safely */
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  background: transparent; /* background handled by header ::before for full-bleed */
  color: var(--white);
  gap: 0.375rem; /* Maintain gap */
  border-radius: var(--radius-sm, 6px);
  text-transform: uppercase;
  font-size: var(--font-sm, 0.8125rem); /* ~13px */
  border: 0;
  cursor: pointer;
  position: relative; /* enable absolute-positioned indicator */
}
.case-file-badge:focus-visible {
  outline: 2px solid var(--white);
  outline-offset: -2px; /* keep within the green bar */
}
/* Rotating disclosure indicator (right triangle → down triangle) */
.case-file-badge::after {
  content: '';
  position: absolute;
  right: 14px;
  top: 50%;
  width: 0;
  height: 0;
  border-style: solid;
  /* draw a right-pointing triangle */
  border-width: 7px 0 7px 10px;
  border-color: transparent transparent transparent rgba(255, 255, 255, 0.9);
  transform: translateY(-50%) rotate(0deg);
  transform-origin: 50% 45%;
  opacity: 0.95;
  transition:
    transform 160ms ease,
    opacity 160ms ease;
}
.case-file-badge[aria-expanded='true']::after {
  /* rotate to become a down-pointing indicator when expanded */
  transform: translateY(-50%) rotate(90deg);
}
@media (prefers-reduced-motion: reduce) {
  .case-file-badge::after {
    transition: none;
  }
}
/* Defensive: if an older build still uses span.reset-contents, ensure it remains clickable */
.case-file-header .case-file-badge.reset-contents {
  all: unset;
  display: flex !important;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  cursor: pointer;
}

/* Case editing form in sidebar */
.case-header input,
.case-header select {
  font-family: inherit;
  background: var(--input-bg);
  border: 1px solid var(--input-border);
  transition:
    border-color 0.2s ease,
    box-shadow 0.2s ease;
}
.case-header input:focus-visible,
.case-header select:focus-visible {
  outline: 2px solid var(--und-green);
  outline-offset: 2px;
}
.case-header input:focus,
.case-header select:focus {
  border-color: var(--und-green);
  box-shadow: var(--elev-focus-ring);
}
.case-header button:hover {
  background-color: var(--bg-hover) !important;
}
/* Match dark state consistently (no data-theme="light") */
html[data-theme='dark'] .case-header {
  background: var(--bg-secondary);
}

/* ========================================
   SIDEBAR NAVIGATION WITH PROGRESS
   ======================================== */
/* Legacy global .section-nav-item pill styles neutralized (underline pattern used instead) */
.section-nav-item {
  background: none;
  border: none;
  box-shadow: none;
  padding: 0;
  margin: 0;
  border-radius: 0;
}
.section-nav-item:hover {
  background: none;
  border: none;
  box-shadow: none;
}
.section-nav-item.active {
  background: none;
  border: none;
  box-shadow: none;
}

/* Tighter rhythm between items on solid gray */
.section-nav-item + .section-nav-item {
  margin-top: 6px;
}

/* Subsection list */
.subsection-toc {
  margin-left: var(--space-6);
  margin-top: var(--space-2);
  padding-left: var(--space-3);
  border-left: 2px solid rgba(255, 255, 255, 0.15);
}
.subsection-item {
  padding: var(--space-1) var(--space-2);
  font-size: var(--font-xs, 0.75rem); /* 12px */
  color: rgba(255, 255, 255, 0.8);
  cursor: pointer;
  transition:
    color 0.2s ease,
    background-color 0.2s ease;
  border-radius: var(--radius-sm);
}
.subsection-item:hover {
  color: var(--color-bg, #ffffff);
  background-color: rgba(255, 255, 255, 0.08);
}
/* Neutralize auto-highlight of current subsection for a simpler look */
.sidebar-nav-panel .subsection-item.current-subsection {
  color: rgba(255, 255, 255, 0.85);
  background: transparent;
  border: none;
}

/* Keyboard focus visibility */
.sidebar-nav-panel .section-nav-item:focus-visible,
.sidebar-nav-panel .subsection-item:focus-visible {
  outline: 3px solid var(--und-orange);
  outline-offset: 2px;
}

/* High-contrast preference support */
@media (prefers-contrast: more) {
  .sidebar-nav-panel {
    box-shadow: var(--elev-focus-neutral);
  }
  .sidebar-nav-panel .section-nav-item {
    border-color: var(--neutral-500);
    background: var(--neutral-100);
  }
  .sidebar-nav-panel .section-nav-item.active {
    background: var(--color-bg, #ffffff);
    border-color: var(--und-green);
    box-shadow: var(--elev-focus-strong);
  }
  .sidebar-nav-panel .subsection-item.current-subsection {
    background: transparent;
    border-color: transparent;
  }
}
/* Progress percentage text styling */
html[data-theme='dark'] .chart-navigation .nav-progress-text {
  color: rgba(255, 255, 255, 0.85);
}

/* .section-anchor scroll offsets are defined in styles.css to keep a single source of truth */

/* Keep left border accent only in light theme */
html:not([data-theme='dark']) .sidebar-nav-panel .section-nav-item:not(.active) {
  border-left: 1px solid var(--neutral-500); /* UND gray spectrum */
}
html:not([data-theme='dark']) .sidebar-nav-panel .section-nav-item:hover:not(.active) {
  border-left-color: var(--neutral-600); /* UND gray spectrum */
}

/* Theme-scoped section items - backgrounds removed for cleaner look */
html:not([data-theme='dark']) .sidebar-nav-panel .section-nav-item {
  border: none !important;
  background: transparent !important;
  box-shadow: none !important;
}
html:not([data-theme='dark']) .sidebar-nav-panel .section-nav-item.active {
  border: none !important;
  background: transparent !important;
  box-shadow: none !important;
  font-weight: 700 !important; /* Keep bold for active state */
}
html:not([data-theme='dark']) .sidebar-nav-panel .section-nav-item.active:hover {
  background: transparent !important;
}

html[data-theme='dark'] .sidebar-nav-panel .section-nav-item {
  border: none !important;
  background: transparent !important;
  box-shadow: none !important;
}
html[data-theme='dark'] .sidebar-nav-panel .section-nav-item.active {
  background: transparent !important;
  box-shadow: none !important;
  font-weight: 700 !important; /* Keep bold for active state */
}

/* Navigation text styles with consistent hierarchy */
.nav-text-primary {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--text);
  line-height: 1.4;
}
.nav-text-secondary {
  font-size: 0.75rem;
  color: var(--text-secondary);
  line-height: 1.4;
}
.nav-text-meta {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 4px;
  display: block;
  line-height: 1.4;
}
.nav-success-indicator {
  color: var(--success);
  font-size: 0.875rem;
  font-weight: 600;
  margin-right: 6px;
}

/* Chart navigation specific */

.case-info-header {
  margin: 0 0 var(--space-2) 0;
  font-size: 1rem;
  font-weight: 600;
  color: var(--text);
  flex: 1;
  line-height: 1.3;
}
.case-info-description {
  font-size: 0.75rem;
  color: var(--text-secondary);
  line-height: 1.4;
}

/* Mobile-first sidebar behavior is now handled by mobile-patch-v2.css */

/* Responsive improvements for section navigation */
@media (max-width: 768px) {
  /* Mobile: adjust padding for better touch targets */
  .chart-navigation .section-card .section-nav-item {
    padding: 1rem 20px; /* increased touch-friendly padding */
    min-height: 44px; /* WCAG touch target minimum */
  }
}

@media (max-width: 640px) {
  /* Small mobile: ensure adequate touch targets */
  .chart-navigation .section-card .section-nav-item {
    padding: 1.25rem 16px; /* even more padding for small screens */
  }
}

/* High DPI displays: ensure text is crisp */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .chart-navigation .section-card .section-nav-item {
    /* Better text rendering on high DPI */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}
